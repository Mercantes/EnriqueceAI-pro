# Story 3.6: CadÃªncias â€” Lista Refatorada

## Status

**Ready for Review**

## Executor Assignment

executor: "@dev"
quality_gate: "@architect"
quality_gate_tools: ["lint", "typecheck", "test", "build"]

## Complexity Estimate

**M (5 points)** â€” Refazer lista com tabs, filtros, migration para novas colunas.

## Risks

- **R1:** Novas colunas em `cadences` requerem migration + update de tipos existentes
- **R2:** Tab "E-mail AutomÃ¡tico" nÃ£o tem engine por trÃ¡s â€” Ã© apenas filtro

## Story

**As a** SDR ou manager,
**I want** uma lista de cadÃªncias com tabs PadrÃ£o/E-mail AutomÃ¡tico, filtros por prioridade e origem, e Ã­cone de prioridade,
**so that** eu possa encontrar e gerenciar cadÃªncias de forma organizada como no Meetime.

## Scope

**IN:**
- Tabs PadrÃ£o / E-mail AutomÃ¡tico
- Filtros: status, prioridade, foco/origem, participantes
- Busca por nome
- Ãcone de prioridade por cadÃªncia
- Menu de aÃ§Ãµes por cadÃªncia
- Contagem dinÃ¢mica
- Migration: colunas priority, origin, type em `cadences`

**OUT:**
- Timeline builder (Story 3.7)
- CriaÃ§Ã£o de cadÃªncia (fluxo existente, adaptar depois)
- Engine de e-mail automÃ¡tico
- Cadence detail page (manter existente)

## Acceptance Criteria

1. Tabs: "PadrÃ£o" e "E-mail AutomÃ¡tico" com badge de contagem
2. Filtros: status, prioridade (alta/mÃ©dia/baixa), foco (inbound ativo/passivo, outbound), participantes (SDRs)
3. Busca por nome de cadÃªncia
4. Ãcone de prioridade: seta verde (alta), amarela (mÃ©dia), cinza (baixa)
5. Menu de aÃ§Ãµes por cadÃªncia (editar, pausar, arquivar, duplicar)
6. Contagem dinÃ¢mica "Exibindo X cadÃªncias"
7. Migration: colunas `priority`, `origin`, `type` em `cadences` com defaults
8. Tipos TypeScript atualizados

## ðŸ¤– CodeRabbit Integration

> **CodeRabbit Integration**: Disabled
>
> CodeRabbit CLI is not enabled in `core-config.yaml`.
> Quality validation will use manual review process only.
> To enable, set `coderabbit_integration.enabled: true` in core-config.yaml

## Tasks / Subtasks

- [x] **Task 1: Migration** (AC: 7)
  - [x] 1.1 Criar migration `supabase/migrations/20260221_000007_cadence_columns.sql`
  - [x] 1.2 ADD COLUMN `priority` TEXT DEFAULT 'medium' CHECK (priority IN ('high','medium','low'))
  - [x] 1.3 ADD COLUMN `origin` TEXT DEFAULT 'outbound' CHECK (origin IN ('inbound_active','inbound_passive','outbound'))
  - [x] 1.4 ADD COLUMN `type` TEXT DEFAULT 'standard' CHECK (type IN ('standard','auto_email'))
  - [x] 1.5 Rollback correspondente

- [x] **Task 2: Atualizar types** (AC: 8)
  - [x] 2.1 Atualizar `src/features/cadences/types/index.ts`
  - [x] 2.2 Adicionar CadencePriority, CadenceOrigin, CadenceType enums
  - [x] 2.3 Atualizar CadenceRow com novas colunas

- [x] **Task 3: Filtros e queries** (AC: 1, 2, 3, 6)
  - [x] 3.1 Atualizar `src/features/cadences/actions/` para aceitar filtros
  - [x] 3.2 Query com filtros: type (tab), priority, origin, status, participantes
  - [x] 3.3 Busca ILIKE por nome

- [x] **Task 4: Lista UI** (AC: 1, 2, 3, 4, 5, 6)
  - [x] 4.1 Refazer componente de lista de cadÃªncias
  - [x] 4.2 Componente Tabs (PadrÃ£o/E-mail AutomÃ¡tico) com badge count
  - [x] 4.3 Barra de filtros com selects
  - [x] 4.4 PriorityIcon component (seta colorida)
  - [x] 4.5 ActionMenu por cadÃªncia (DropdownMenu)
  - [x] 4.6 Contagem dinÃ¢mica

- [x] **Task 5: Testes**
  - [x] 5.1 Testes para filtros de cadÃªncia
  - [x] 5.2 Testes para PriorityIcon component
  - [x] 5.3 Testes para tabs com contagem

## Dev Notes

**Source Tree:**
```
src/features/cadences/types/index.ts    â†’ Adicionar novos types
src/features/cadences/actions/           â†’ Atualizar queries com filtros
src/features/cadences/components/        â†’ Refazer lista
src/app/(app)/cadences/page.tsx          â†’ Atualizar page
```

**Cadence type atual:** id, org_id, name, description, status (draft|active|paused|archived), total_steps, created_by, deleted_at, created_at, updated_at. Sem priority, origin ou type.

**Meetime Reference:** Screenshots 3-4 â€” Lista com tabs, filtros, Ã­cone de prioridade

### Testing

- **Framework:** Vitest + Testing Library
- **Location:** `src/features/cadences/**/*.test.ts`
- **Rodar:** `pnpm vitest run src/features/cadences`

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-21 | 1.0 | Story criada a partir do Epic 3 | @sm (River) |
| 2026-02-21 | 1.1 | Implementation complete â€” all tasks done | @dev (Dex) |

## Dev Agent Record

### Agent Model Used
Claude Opus 4.6

### Debug Log References
- No significant debug issues encountered
- Existing test fixtures needed priority/origin/type fields added to CadenceRow

### Completion Notes List
- Migration adds priority, origin, type columns with CHECK constraints and defaults
- CadencePriority, CadenceOrigin, CadenceType enums added to types
- fetchCadences now accepts type, priority, origin filters
- fetchCadenceTabCounts returns standard/auto_email counts for tab badges
- CadenceListView refactored: tabs, search icon, priority/origin/status filters, PriorityIcon, expanded action menu (edit, pause, archive, duplicate, delete)
- PriorityIcon: ArrowUp with green (high), yellow (medium), gray (low)
- Page passes type=standard as default tab filter + parallel tab counts fetch
- 14 new tests: 7 PriorityIcon + 7 CadenceListView (tabs, priority icon, filters, search, action menu, dynamic count)

### File List
- `supabase/migrations/20260221_000007_cadence_columns.sql` â€” NEW
- `src/features/cadences/types/index.ts` â€” MODIFIED (CadencePriority, CadenceOrigin, CadenceType)
- `src/features/cadences/index.ts` â€” MODIFIED (barrel exports)
- `src/features/cadences/actions/fetch-cadences.ts` â€” MODIFIED (filters + fetchCadenceTabCounts)
- `src/features/cadences/actions/fetch-cadences.test.ts` â€” MODIFIED (baseCadence updated)
- `src/features/cadences/components/PriorityIcon.tsx` â€” NEW
- `src/features/cadences/components/PriorityIcon.test.tsx` â€” NEW
- `src/features/cadences/components/CadenceListView.tsx` â€” MODIFIED (tabs, filters, PriorityIcon, action menu)
- `src/features/cadences/components/CadenceListView.test.tsx` â€” MODIFIED (7 new tests + fixture updates)
- `src/features/cadences/components/CadenceBuilder.test.tsx` â€” MODIFIED (fixture updated)
- `src/app/(app)/cadences/page.tsx` â€” MODIFIED (new filters + tabCounts)
