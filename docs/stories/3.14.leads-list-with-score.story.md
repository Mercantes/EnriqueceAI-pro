# Story 3.14: Leads — Lista Refatorada com Score

## Status

**Draft**

## Executor Assignment

executor: "@dev"
quality_gate: "@architect"
quality_gate_tools: ["lint", "typecheck", "test", "build"]

## Complexity Estimate

**S (3 points)** — UI update na lista existente de leads.

## Risks

- **R1:** Score circle visual precisa de SVG ou CSS ring — complexidade visual
- **R2:** Ordenação por score pode conflitar com ordenação existente

## Story

**As a** SDR ou manager,
**I want** ver o Fit Score visual na lista de leads com avatar score circle e status badges,
**so that** eu possa rapidamente identificar os leads mais qualificados.

## Scope

**IN:**
- Avatar com score circle visual
- Status badges Meetime-style
- Coluna Responsável
- Menu de ações por lead
- Ordenação por score

**OUT:**
- Página de detalhe do lead (manter existente)
- Importação CSV (manter existente)
- Enriquecimento (manter existente)
- Filtro avançado por score range

## Acceptance Criteria

1. Avatar com score circle: anel colorido ao redor do avatar (verde >=7, amarelo 4-6, vermelho <=3, cinza se null)
2. Score numérico visível dentro ou ao lado do circle
3. Status badges: ATIVO (verde), ESPERANDO INICIO (cinza) — mapear de status existente
4. Coluna "Responsável" mostrando SDR atribuído (created_by ou campo futuro)
5. Menu de ações por lead (editar, arquivar, mover cadência, etc.)
6. Leads ordenáveis por fit_score (ascendente/descendente)
7. Compatível com busca e filtros existentes (sem regressão)

## CodeRabbit Integration

> **CodeRabbit Integration**: Disabled
>
> CodeRabbit CLI is not enabled in `core-config.yaml`.
> Quality validation will use manual review process only.
> To enable, set `coderabbit_integration.enabled: true` in core-config.yaml

## Tasks / Subtasks

- [ ] **Task 1: Score Circle component** (AC: 1, 2)
  - [ ] 1.1 Criar `src/features/leads/components/LeadScoreCircle.tsx`
  - [ ] 1.2 SVG ring com cor baseada no score
  - [ ] 1.3 Score numérico centralizado
  - [ ] 1.4 Props: score (number | null), size

- [ ] **Task 2: Status badges** (AC: 3)
  - [ ] 2.1 Mapear lead.status -> Meetime labels (new->ESPERANDO INICIO, contacted/qualified->ATIVO, etc.)
  - [ ] 2.2 Componente `LeadStatusBadge.tsx`

- [ ] **Task 3: Atualizar lista** (AC: 4, 5, 6, 7)
  - [ ] 3.1 Integrar LeadScoreCircle no avatar da tabela
  - [ ] 3.2 Adicionar coluna Responsável
  - [ ] 3.3 Adicionar ActionMenu por lead
  - [ ] 3.4 Adicionar sort by fit_score
  - [ ] 3.5 Verificar que filtros/busca existentes continuam funcionando

- [ ] **Task 4: Testes**
  - [ ] 4.1 Testes para LeadScoreCircle (cores por range, null state)
  - [ ] 4.2 Testes para LeadStatusBadge (mapeamento correto)
  - [ ] 4.3 Teste de regressão: lista existente funciona

## Dev Notes

**Dependência:** Story 3.13 (coluna fit_score existe e é calculada).

**Score circle colors:**
- score >= 7: `text-green-500` / `stroke-green-500`
- score 4-6: `text-yellow-500` / `stroke-yellow-500`
- score <= 3: `text-red-500` / `stroke-red-500`
- null: `text-gray-300` / `stroke-gray-300`

**Meetime Reference:** Screenshot 14 — Lista de leads com avatar score circle

### Testing

- **Framework:** Vitest + Testing Library
- **Location:** `src/features/leads/**/*.test.ts`
- **Rodar:** `pnpm vitest run src/features/leads`

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-21 | 1.0 | Story criada a partir do Epic 3 | @sm (River) |

## Dev Agent Record

### Agent Model Used
_To be filled by dev agent_

### Debug Log References
_To be filled by dev agent_

### Completion Notes List
_To be filled by dev agent_

### File List
_To be filled by dev agent_
