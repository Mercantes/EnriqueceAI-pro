# Story 3.1: Reestruturar Navega√ß√£o (Meetime-style)

## Status

**Done**

## Executor Assignment

executor: "@dev"
quality_gate: "@architect"
quality_gate_tools: ["lint", "typecheck", "test", "build"]

## Complexity Estimate

**XL (8 points)** ‚Äî Substitui√ß√£o completa do sistema de navega√ß√£o (sidebar ‚Üí top bar).

## Risks

- **R1:** Navega√ß√£o top bar pode quebrar layout mobile existente
- **R2:** Rotas existentes dependem do sidebar layout ‚Äî regress√£o potencial
- **R3:** Breadcrumbs contextuais exigem tracking de hierarquia de rotas

## Story

**As a** SDR ou manager,
**I want** uma navega√ß√£o horizontal (top bar) com menus dropdown,
**so that** a experi√™ncia seja id√™ntica ao Meetime Flow e facilite o acesso r√°pido a todas as se√ß√µes.

## Scope

**IN:**
- Top bar horizontal com dropdowns (Prospec√ß√£o, Liga√ß√µes, Estat√≠sticas)
- Menu mobile (hamburger)
- Breadcrumbs contextuais
- Sub-bar com a√ß√µes r√°pidas (Ligar, Usu√°rio)
- Remo√ß√£o da sidebar atual

**OUT:**
- Conte√∫do das p√°ginas de destino (outras stories)
- M√≥dulo de Liga√ß√µes (Wave 4)
- M√≥dulo de Estat√≠sticas (Wave 4)
- Anima√ß√µes/transi√ß√µes avan√ßadas

## Acceptance Criteria

1. Top bar horizontal substitui completamente a sidebar
2. Dropdown "Prospec√ß√£o" com submenus: Execu√ß√£o, Atividades, Cad√™ncias, Leads, Ajustes
3. Dropdown "Liga√ß√µes" (placeholder para Wave 4)
4. Dropdown "Estat√≠sticas" (placeholder para Wave 4)
5. √Årea direita: √≠cone notifica√ß√µes (bell), help (?), avatar do usu√°rio com dropdown
6. Responsivo: hamburger menu em mobile com drawer
7. Breadcrumbs contextuais abaixo da top bar
8. Sub-bar com bot√£o "Ligar" e link "Usu√°rio"
9. Rota `/settings` acess√≠vel via Prospec√ß√£o > Ajustes
10. Nenhuma rota existente quebrada (zero regress√£o)

## ü§ñ CodeRabbit Integration

> **CodeRabbit Integration**: Disabled
>
> CodeRabbit CLI is not enabled in `core-config.yaml`.
> Quality validation will use manual review process only.
> To enable, set `coderabbit_integration.enabled: true` in core-config.yaml

## Tasks / Subtasks

- [x] **Task 1: Criar componente TopBar** (AC: 1, 5)
  - [x] 1.1 Criar `src/shared/components/TopBar.tsx`
  - [x] 1.2 Logo Flux √† esquerda
  - [x] 1.3 Menu principal: Dashboard | Prospec√ß√£o ‚ñº | Liga√ß√µes ‚ñº | Estat√≠sticas ‚ñº
  - [x] 1.4 √Årea direita: NotificationBell, HelpButton, UserAvatarDropdown
  - [x] 1.5 Sub-bar com "Ligar" button e "Usu√°rio" link

- [x] **Task 2: Criar componente DropdownNav** (AC: 2, 3, 4)
  - [x] 2.1 Dropdown "Prospec√ß√£o" com items: Execu√ß√£o, Atividades, Cad√™ncias, Leads, Ajustes
  - [x] 2.2 Dropdown "Liga√ß√µes" (placeholder com "Em breve")
  - [x] 2.3 Dropdown "Estat√≠sticas" (placeholder com "Em breve")
  - [x] 2.4 Usar Radix `DropdownMenu` do shadcn/ui

- [x] **Task 3: Componente MobileNav** (AC: 6)
  - [x] 3.1 Hamburger button vis√≠vel em telas < 768px
  - [x] 3.2 Sheet/Drawer com menu completo
  - [x] 3.3 Fechar ao navegar

- [x] **Task 4: Breadcrumbs** (AC: 7)
  - [x] 4.1 Atualizar `src/shared/components/Breadcrumbs.tsx`
  - [x] 4.2 Mapear rotas para labels leg√≠veis (execution, calls, statistics, history)
  - [x] 4.3 Renderizar abaixo da top bar no layout

- [x] **Task 5: Atualizar layout** (AC: 1, 9, 10)
  - [x] 5.1 Refatorar `src/app/(app)/layout.tsx` ‚Äî remover sidebar, adicionar TopBar
  - [x] 5.2 AppSidebar.tsx deprecado (sem importa√ß√µes, c√≥digo morto)
  - [x] 5.3 AppHeader.tsx substitu√≠do por TopBar (sem importa√ß√µes, c√≥digo morto)
  - [x] 5.4 Verificar que todas as rotas existentes funcionam (build OK)

- [x] **Task 6: Testes** (AC: 10)
  - [x] 6.1 Testes para TopBar (11 testes: renderiza items, dropdowns abrem, submenu items)
  - [x] 6.2 Testes para MobileNav (6 testes: hamburger, drawer, expand sections)
  - [x] 6.3 Testes para Breadcrumbs (7 testes: labels existentes + novos)
  - [x] 6.4 Teste de regress√£o: 598 testes passando, zero falhas

## Dev Notes

**Source Tree relevante:**
```
src/shared/components/AppSidebar.tsx   ‚Üí REMOVER/SUBSTITUIR
src/shared/components/AppHeader.tsx    ‚Üí REFATORAR como TopBar
src/app/(app)/layout.tsx               ‚Üí Remover SidebarProvider, usar TopBar
src/lib/auth/permissions.ts            ‚Üí Adaptar canAccessPath se necess√°rio
```

**Padr√µes a seguir:**
- Usar componentes shadcn/ui: `DropdownMenu`, `Sheet`, `Button`, `Avatar`, `Badge`
- Path aliases: `@/*` ‚Üí `./src/*`
- Manter `OrganizationProvider` e `NotificationProvider` no layout
- Manter middleware CSRF/auth inalterado

**Meetime Reference:** Screenshots 1-2 ‚Äî Top bar com logo, menus dropdown, notifica√ß√µes, avatar

### Testing

- **Framework:** Vitest + Testing Library
- **Location:** Colocar testes em `src/shared/components/__tests__/` ou colocados junto ao componente
- **Pattern:** `vi.mock()` para depend√™ncias, `render()` + `screen.getByRole()`
- **Rodar:** `pnpm vitest run src/shared/components`

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-21 | 1.0 | Story criada a partir do Epic 3 | @sm (River) |
| 2026-02-21 | 1.1 | Implementa√ß√£o completa: TopBar, MobileNav, Breadcrumbs, layout | @dev (Dex) |

## Dev Agent Record

### Agent Model Used
Claude Opus 4.6

### Debug Log References
- Lint: pass (zero errors)
- Typecheck: pass (zero errors)
- Tests: 66 files, 598 passed, 0 failed
- Build: pass (all routes present)

### Completion Notes List
- TopBar e DropdownNav implementados em TopBar.tsx com navSections exportado
- MobileNav com Sheet drawer, se√ß√µes colaps√°veis e sub-actions
- Breadcrumbs atualizado com labels: execution, calls, statistics, history
- Layout refatorado: flex h-screen flex-col (vertical) com TopBar no topo
- AppSidebar.tsx e AppHeader.tsx mantidos como c√≥digo morto (sem importa√ß√µes)
- ThemeToggle preservado na √°rea direita do TopBar
- Radix DropdownMenu usado para dropdowns desktop, Sheet para mobile drawer
- SheetDescription adicionado para acessibilidade (eliminar warning Radix)

### File List
| File | Action |
|------|--------|
| `src/shared/components/TopBar.tsx` | **Created** ‚Äî Top bar com logo, nav desktop, dropdowns, sub-bar |
| `src/shared/components/MobileNav.tsx` | **Created** ‚Äî Hamburger trigger + Sheet drawer mobile |
| `src/shared/components/Breadcrumbs.tsx` | **Modified** ‚Äî Adicionado labels: execution, calls, statistics, history |
| `src/app/(app)/layout.tsx` | **Modified** ‚Äî Removido sidebar, adicionado TopBar, layout vertical |
| `src/shared/components/TopBar.test.tsx` | **Created** ‚Äî 11 testes |
| `src/shared/components/MobileNav.test.tsx` | **Created** ‚Äî 6 testes |
| `src/shared/components/Breadcrumbs.test.tsx` | **Modified** ‚Äî 3 testes adicionados para novos labels |
| `src/shared/components/AppSidebar.tsx` | **Deprecated** ‚Äî Sem importa√ß√µes, c√≥digo morto |
| `src/shared/components/AppHeader.tsx` | **Deprecated** ‚Äî Sem importa√ß√µes, c√≥digo morto |
